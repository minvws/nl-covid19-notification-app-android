steps:
  - task: DownloadSecureFile@1
    name: keystoreFile
    inputs:
      secureFile: coronamelder-keystore.jks
    displayName: Download keystore
  - bash: |
      echo "##vso[task.setvariable variable=KEYSTORE_FILE]$(keystoreFile.secureFilePath)"
    displayName: Set key store path
  - script: |
      git log -1 --format=%B > app/src/main/play/release-notes/nl-NL/internal.txt
    displayName: Set release notes
  - task: Gradle@2
    displayName: Sign pentest build
    inputs:
      gradleOptions: $(GRADLE_JVM_OPTIONS)
      options: $(GRADLE_OPTIONS)
      publishJUnitResults: false
      tasks: 'app:assemTstRelease app:assemPentestRelease'
    env:
      KEYSTORE_PASSWORD: $(KeystorePassword)
      KEYSTORE_KEY_PASSWORD: $(KeystoreKeyPassword)
      KEYSTORE_KEY_ALIAS: $(KeystoreKeyAlias)
  - publish: app/build/outputs/apk
    displayName: Publish APKs artifacts
    artifact: apk
